=============================================
Build NVIDIA CUDA 7.5
=============================================
Download
https://developer.nvidia.com/cuda-toolkit-archive

CUDA_SOVERSION='7.5.18'
CUDA_BUILD='19867135'

sh cuda_"$CUDA_SOVERSION"_linux.run --noexec --keep --target cuda
sh cuda/run_files/cuda-linux64-rel-$CUDA_SOVERSION-$CUDA_BUILD.run --noexec --keep --target cuda-linux64

cd cuda-linux64
sed -i '/^-vm$/d; /^..\/jre\/bin\/java$/d' libnvvp/nvvp.ini libnsight/nsight.ini

chmod -x libnvvp/*.xpm
chmod -x libnsight/*.xpm
chmod -x bin/crt/link.stub
chmod -x bin/crt/prelink.stub
chmod -x nvvm/include/*.h
chmod -x nvvm/libnvvm-samples/build.bat

rm bin/nsight
rm bin/nvvp
rm bin/nvcc.profile

find libnsight libnvvp -name 'license.html' -exec sed -r -i \
    -e 's,(<script type="text/javascript" )src(="http://w.sharethis.com/button/buttons.js"[^>]*></script>),<!-- \1DISABLED\2 -->,' \
    {} +

mkdir -p ../opt/cuda/"$CUDA_SOVERSION"
mkdir -p ../opt/cuda/"$CUDA_SOVERSION"/share

mv bin ../opt/cuda/"$CUDA_SOVERSION"/
mv lib64 ../opt/cuda/"$CUDA_SOVERSION"/lib
mv lib ../opt/cuda/"$CUDA_SOVERSION"/lib32
mv include ../opt/cuda/"$CUDA_SOVERSION"/
mv extras/Debugger/include ../opt/cuda/"$CUDA_SOVERSION"/include/cuda-gdb
mv extras/CUPTI/include/* ../opt/cuda/"$CUDA_SOVERSION"/include/
mv extras/CUPTI/lib64/* ../opt/cuda/"$CUDA_SOVERSION"/lib/

mv nvvm/bin/* ../opt/cuda/"$CUDA_SOVERSION"/bin/
mv nvvm/include/* ../opt/cuda/"$CUDA_SOVERSION"/include/
mv nvvm/lib64/* ../opt/cuda/"$CUDA_SOVERSION"/lib/
mv nvvm/libdevice ../opt/cuda/"$CUDA_SOVERSION"/
mv doc/man ../opt/cuda/"$CUDA_SOVERSION"/share/
mv libnsight ../opt/cuda/"$CUDA_SOVERSION"/
mv libnvvp ../opt/cuda/"$CUDA_SOVERSION"/

=============================================
Patch
=============================================
### nsight:
#!/bin/sh

CUDA_SOVERSION='7.5.18'
CUDA_BIN='/opt/cuda/$CUDA_SOVERSION/bin'
CUDA_LIB='/opt/cuda/$CUDA_SOVERSION/lib'
CUDA_LIB32='/opt/cuda/$CUDA_SOVERSION/lib32'

PATH=$PATH:$CUDA_BIN
LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CUDA_LIB:$CUDA_LIB32
UBUNTU_MENUPROXY=0 LIBOVERLAY_SCROLLBAR=0 /opt/cuda/$CUDA_SOVERSION/libnsight/nsight $@

mv nsight ../opt/cuda/"$CUDA_SOVERSION"/bin/
chmod 755 ../opt/cuda/"$CUDA_SOVERSION"/bin/nsight

### nvvp:
#!/bin/sh

CUDA_SOVERSION='7.5.18'
CUDA_BIN='/opt/cuda/$CUDA_SOVERSION/bin'
CUDA_LIB='/opt/cuda/$CUDA_SOVERSION/lib'
CUDA_LIB32='/opt/cuda/$CUDA_SOVERSION/lib32'

PATH=$PATH:$CUDA_BIN
LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CUDA_LIB:$CUDA_LIB32
UBUNTU_MENUPROXY=0 LIBOVERLAY_SCROLLBAR=0 /opt/cuda/$CUDA_SOVERSION/libnvvp/nvvp $@

mv nvvp ../opt/cuda/"$CUDA_SOVERSION"/bin/
chmod 755 ../opt/cuda/"$CUDA_SOVERSION"/bin/nvvp

### nvcc.profile:
NVVMIR_LIBRARY_DIR = /opt/cuda/7.5.18/libdevice
LD_LIBRARY_PATH += /opt/cuda/7.5.18/:
PATH		+= /opt/cuda/7.5.18/bin:
INCLUDES        += "-I/opt/cuda/7.5.18/include" $(_SPACE_)
LIBRARIES	=+ $(_SPACE_) "-L/opt/cuda/7.5.18/lib/stubs" "-L/opt/cuda/7.5.18/lib" "-L/opt/cuda/7.5.18/lib32"

mv nvcc.profile ../opt/cuda/"$CUDA_SOVERSION"/bin/
chmod 755 ../opt/cuda/"$CUDA_SOVERSION"/bin/nvcc.profile

=============================================
安裝必要依賴
=============================================
CUDA:
sudo apt-get install libthrust-dev gcc g++ clang libthrust-dev libstdc++6 opencl-headers

cuda-gdb:
sudo apt-get install libexpat1 libncurses5

nvvp、nsight:
sudo apt-get install default-jre libgtk2.0-0 perl

=============================================
安裝 CUDA
=============================================
sduo -s
cd /
tar Jxvf cuda-*.tar.xz

=============================================
編譯使用參數
=============================================
CUDA_SOVERSION='7.5.18'
CUDA_BIN='/opt/cuda/$CUDA_SOVERSION/bin'
CUDA_LIB='/opt/cuda/$CUDA_SOVERSION/lib'
CUDA_LIB32='/opt/cuda/$CUDA_SOVERSION/lib32'
export PATH=$PATH:$CUDA_BIN
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CUDA_LIB:$CUDA_LIB32
